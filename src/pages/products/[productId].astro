---
import ProductLandingPage from '../../components/ProductLandingPage.astro';
import { listAvailableProducts, listProductLocales } from '../../utils/loadProduct';
import { siteConfig } from '../../config';

export const getStaticPaths = () => {
  const products = listAvailableProducts();
  return products.map((productId) => ({
    params: { productId },
    props: {
      locales: listProductLocales(productId),
      defaultLocale: siteConfig.locales.default
    }
  }));
};

const { productId } = Astro.params;
const { locales = [], defaultLocale } = Astro.props as { locales?: string[]; defaultLocale?: string };
const availableProducts = listAvailableProducts();

if (!productId || !availableProducts.includes(productId)) {
  throw new Error(`找不到產品 ${productId}，請確認資料夾是否存在。`);
}

// 直接渲染預設語言的頁面，避免中間重定向頁
const targetLocale =
  locales.find((item) => item === siteConfig.locales.default) ??
  locales[0] ??
  defaultLocale ??
  siteConfig.locales.default;

<ProductLandingPage productId={productId} locale={targetLocale} />
---
